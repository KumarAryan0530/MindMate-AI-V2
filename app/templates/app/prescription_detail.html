{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-6xl mx-auto">
        <!-- Back Button -->
        <a href="{% url 'prescription_list' %}" class="inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors mb-6">
            <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Prescriptions
        </a>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Original Image/PDF Section -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4">
                    <h2 class="text-2xl font-bold text-white">Original Document</h2>
                </div>
                
                <div class="p-6">
                    <div class="bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center">
                        {% if prescription.prescription_image %}
                        <img src="{{ prescription.prescription_image.url }}" 
                             alt="Prescription" 
                             class="max-w-full h-auto rounded-lg shadow-md">
                        {% elif prescription.prescription_file %}
                        <div class="text-center">
                            <svg class="h-32 w-32 mx-auto text-red-500 mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
                            </svg>
                            <p class="text-gray-600 font-semibold mb-4">PDF Document</p>
                            <a href="{{ prescription.prescription_file.url }}" 
                               target="_blank"
                               class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors">
                                <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                View PDF
                            </a>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Metadata -->
                    <div class="mt-6 space-y-2">
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600 font-medium">Uploaded:</span>
                            <span class="text-gray-800">{{ prescription.created_at|date:"F d, Y" }}</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600 font-medium">Time:</span>
                            <span class="text-gray-800">{{ prescription.created_at|time:"h:i A" }}</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600 font-medium">Last Updated:</span>
                            <span class="text-gray-800">{{ prescription.updated_at|date:"F d, Y" }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Extracted Information Section -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-green-600 to-teal-600 px-6 py-4">
                    <h2 class="text-2xl font-bold text-white">Extracted Information</h2>
                </div>
                
                <div class="p-6">
                    {% if prescription.extracted_text %}
                    <div class="prose prose-sm max-w-none bg-gray-50 rounded-lg p-6 min-h-[400px]">
                        {{ prescription.extracted_text|safe }}
                    </div>
                    {% else %}
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-700">
                                    No extracted information available. The analysis may have failed or is still processing.
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Actions -->
                <div class="px-6 pb-6 flex gap-3">
                    <a href="{% url 'prescription_delete' prescription.pk %}" 
                       class="flex-1 text-center bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-3 px-4 rounded-lg transition-colors">
                        <svg class="h-5 w-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        Delete Prescription
                    </a>
                    <button onclick="window.print()" 
                            class="flex-1 text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                        <svg class="h-5 w-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                        </svg>
                        Print
                    </button>
                </div>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="mt-8 bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-lg shadow-md">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-6 w-6 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-semibold text-yellow-800 mb-1">Important Medical Disclaimer</h3>
                    <p class="text-sm text-yellow-700">
                        This extracted information is generated by AI and should be used for reference only. 
                        Always verify with your original prescription and consult your doctor or pharmacist 
                        for any questions about your medications, dosages, or instructions.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        body * {
            visibility: hidden;
        }
        .prose, .prose * {
            visibility: visible;
        }
        .prose {
            position: absolute;
            left: 0;
            top: 0;
        }
    }
</style>
{% endblock %}
